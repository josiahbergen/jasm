{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "name": "JASM",
    "scopeName": "source.jasm",
    "patterns": [
      {
        "comment": "Comments: ; followed by anything (must be first to prevent other patterns matching)",
        "match": ";.*$",
        "name": "comment.line.semicolon.jasm"
      },
      {
        "comment": "String literals",
        "begin": "\"",
        "end": "\"",
        "name": "string.quoted.double.jasm",
        "patterns": [
          {
            "match": "\\\\.",
            "name": "constant.character.escape.jasm"
          }
        ]
      },
      {
        "comment": "Directives: DATA, IMPORT",
        "match": "\\b(?i)(DATA|IMPORT)\\b",
        "name": "keyword.control.directive.jasm"
      },
      {
        "comment": "Macro keywords: MACRO, END MACRO",
        "match": "\\b(?i)(MACRO|END\\s+MACRO)\\b",
        "name": "keyword.control.macro.jasm"
      },
      {
        "comment": "Macro arguments: %label_name (must come before expressions to avoid % matching as operator)",
        "match": "(%)([A-Za-z_][A-Za-z0-9_]*)",
        "captures": {
          "1": { "name": "punctuation.definition.macro.jasm" },
          "2": { "name": "variable.parameter.macro.jasm" }
        },
        "name": "meta.macro.argument.jasm"
      },
      {
        "comment": "Expressions: ( ... ) with operators",
        "begin": "\\(",
        "end": "\\)",
        "beginCaptures": {
          "0": { "name": "punctuation.section.expression.begin.jasm" }
        },
        "endCaptures": {
          "0": { "name": "punctuation.section.expression.end.jasm" }
        },
        "name": "meta.expression.jasm",
        "patterns": [
          {
            "include": "#expression-content"
          }
        ]
      },
      {
        "comment": "Mnemonics (updated per EBNF)",
        "match": "\\b(?i)(GET|PUT|MOV|PUSH|POP|ADD|ADC|SUB|SBC|INC|DEC|LSH|RSH|AND|OR|NOR|NOT|XOR|INB|OUTB|CMP|JMP|JZ|JNZ|JC|JNC|CALL|RET|INT|IRET|HALT|NOP)\\b",
        "name": "keyword.control.mnemonic.jasm"
      },
      {
        "comment": "Registers",
        "match": "\\b(?i)(A|B|C|D|E|X|Y|PC|SP|MB|F|Z)\\b",
        "name": "variable.language.register.jasm"
      },
      {
        "comment": "Numbers: Hex (Priority 20)",
        "match": "\\b0[xX][0-9a-fA-F]+\\b",
        "name": "constant.numeric.hex.jasm"
      },
      {
        "comment": "Numbers: Binary (Priority 20) - lowercase 'b' prefix",
        "match": "\\bb[01]+\\b",
        "name": "constant.numeric.binary.jasm"
      },
      {
        "comment": "Numbers: Decimal (Priority 20)",
        "match": "\\b[0-9]+\\b",
        "name": "constant.numeric.decimal.jasm"
      },
      {
        "comment": "Label Definition (Priority 10) - Matches 'label:' at start of line",
        "match": "^\\s*([A-Za-z_][A-Za-z0-9_]*)\\s*(:)",
        "captures": {
          "1": { "name": "entity.name.function.label.jasm" },
          "2": { "name": "punctuation.separator.colon.jasm" }
        }
      },
      {
        "comment": "Label Reference / Operand",
        "match": "\\b[A-Za-z_][A-Za-z0-9_]*\\b",
        "name": "variable.other.label.jasm"
      },
      {
        "comment": "Separators (commas)",
        "match": ",",
        "name": "punctuation.separator.delimiter.jasm"
      }
    ],
    "repository": {
      "expression-content": {
        "patterns": [
          {
            "comment": "Operators in expressions (exclude % which is for macro args)",
            "match": "(?i)(\\+|\\-|\\*|/|<<|>>|&|\\||\\^|~)",
            "name": "keyword.operator.arithmetic.jasm"
          },
          {
            "comment": "Modulo operator (only in expressions, not macro args)",
            "match": "%(?![A-Za-z_])",
            "name": "keyword.operator.arithmetic.jasm"
          },
          {
            "comment": "Nested expressions",
            "begin": "\\(",
            "end": "\\)",
            "beginCaptures": {
              "0": { "name": "punctuation.section.expression.begin.jasm" }
            },
            "endCaptures": {
              "0": { "name": "punctuation.section.expression.end.jasm" }
            },
            "name": "meta.expression.jasm",
            "patterns": [
              {
                "include": "#expression-content"
              }
            ]
          },
          {
            "comment": "Numbers in expressions",
            "match": "\\b(0[xX][0-9a-fA-F]+|b[01]+|[0-9]+)\\b",
            "name": "constant.numeric.jasm"
          },
          {
            "comment": "Macro arguments in expressions",
            "match": "(%)([A-Za-z_][A-Za-z0-9_]*)",
            "captures": {
              "1": { "name": "punctuation.definition.macro.jasm" },
              "2": { "name": "variable.parameter.macro.jasm" }
            },
            "name": "meta.macro.argument.jasm"
          }
        ]
      }
    }
  }